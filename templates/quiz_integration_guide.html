<!-- ============================================================================
     WHO AM I? - QUIZ PAGE INTEGRATION GUIDE
     ============================================================================
     
     This file shows the key changes needed to integrate Who Am I into your
     existing quiz.html template.
     
     STEP 1: Add CSS and JS files to the <head> section
     ============================================================================ -->

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/who_am_i.css') }}">
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/who_am_i.js') }}"></script>
{% endblock %}


<!-- ============================================================================
     STEP 2: Add Who Am I container in quiz template
     ============================================================================
     
     Place this ABOVE your question display area, but inside your main quiz container
     ============================================================================ -->

<div class="container mt-4">
    <!-- WHO AM I REVEAL GRID - Only show for Descriptive Statistics (pilot) -->
    {% if topic == 'Descriptive Statistics' %}
    <div id="who-am-i-container" class="who-am-i-container">
        <!-- Content populated by JavaScript -->
        <div class="text-center">
            <i class="fas fa-spinner fa-spin fa-2x text-white"></i>
            <p class="text-white mt-2">Loading Who Am I?...</p>
        </div>
    </div>
    {% endif %}
    
    <!-- EXISTING QUIZ CONTENT BELOW -->
    <div class="card">
        <div class="card-header">
            <h4>Question {{ current_question_num }} of {{ total_questions }}</h4>
        </div>
        <div class="card-body">
            <!-- Your existing question HTML -->
        </div>
    </div>
</div>


<!-- ============================================================================
     STEP 3: Initialize Who Am I when quiz starts
     ============================================================================
     
     Add this JavaScript at the bottom of your quiz template, in a <script> block
     ============================================================================ -->

<script>
// Initialize Who Am I when page loads
document.addEventListener('DOMContentLoaded', function() {
    {% if topic == 'Descriptive Statistics' %}
    // Initialize the Who Am I reveal
    const topic = "{{ topic }}";
    const difficulty = "{{ difficulty }}";
    const quizAttemptId = {{ quiz_attempt_id if quiz_attempt_id else 'null' }};
    
    initializeWhoAmI(topic, difficulty, quizAttemptId);
    {% endif %}
});
</script>


<!-- ============================================================================
     STEP 4: Call onCorrectAnswer() when user answers correctly
     ============================================================================
     
     In your existing JavaScript that handles answer submission, add this call
     when the answer is correct:
     ============================================================================ -->

<script>
function checkAnswer(selectedOption) {
    // Your existing answer checking code...
    
    const isCorrect = (selectedOption === correctAnswer);
    
    if (isCorrect) {
        // YOUR EXISTING CODE HERE (points, feedback, etc.)
        
        // NEW: Reveal a tile in Who Am I
        {% if topic == 'Descriptive Statistics' %}
        onCorrectAnswer();
        {% endif %}
    }
    
    // Rest of your existing code...
}
</script>


<!-- ============================================================================
     STEP 5: Include bonus points in final score
     ============================================================================
     
     When submitting the quiz results, include the Who Am I bonus:
     ============================================================================ -->

<script>
function submitQuizResults() {
    const regularPoints = calculateRegularPoints(); // Your existing function
    
    {% if topic == 'Descriptive Statistics' %}
    const whoAmIBonus = getWhoAmIBonusPoints();
    const totalPoints = regularPoints + whoAmIBonus;
    {% else %}
    const totalPoints = regularPoints;
    {% endif %}
    
    // Submit to backend with total points
    fetch('/submit_quiz', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            quiz_attempt_id: quizAttemptId,
            points: totalPoints,
            who_am_i_bonus: whoAmIBonus || 0
        })
    });
}
</script>


<!-- ============================================================================
     ALTERNATIVE: Complete Example Quiz Template
     ============================================================================
     
     Below is a simplified complete example showing all pieces together
     ============================================================================ -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ topic }} Quiz - AgentMath.app</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Who Am I CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/who_am_i.css') }}">
    <!-- Your custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/quiz.css') }}">
</head>
<body>
    
<div class="container mt-4">
    <!-- Who Am I Feature (pilot for Descriptive Statistics) -->
    {% if topic == 'Descriptive Statistics' %}
    <div id="who-am-i-container" class="who-am-i-container mb-4">
        <div class="text-center">
            <i class="fas fa-spinner fa-spin fa-2x text-white"></i>
            <p class="text-white mt-2">Loading mystery image...</p>
        </div>
    </div>
    {% endif %}
    
    <!-- Quiz Content -->
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">{{ topic }} - {{ difficulty|capitalize }}</h4>
            <small>Question <span id="question-num">1</span> of {{ total_questions }}</small>
        </div>
        
        <div class="card-body">
            <div id="question-container">
                <!-- Question loaded here via JavaScript or server-side -->
            </div>
        </div>
        
        <div class="card-footer">
            <div class="d-flex justify-content-between align-items-center">
                <span>Score: <strong id="current-score">0</strong> points</span>
                <button class="btn btn-primary" id="next-question-btn">Next Question</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Who Am I JS -->
<script src="{{ url_for('static', filename='js/who_am_i.js') }}"></script>

<script>
// Quiz variables
const topic = "{{ topic }}";
const difficulty = "{{ difficulty }}";
const quizAttemptId = {{ quiz_attempt_id if quiz_attempt_id else 'null' }};
let currentScore = 0;

// Initialize Who Am I on page load
document.addEventListener('DOMContentLoaded', function() {
    {% if topic == 'Descriptive Statistics' %}
    initializeWhoAmI(topic, difficulty, quizAttemptId);
    {% endif %}
    
    loadFirstQuestion();
});

// When user answers correctly
function handleCorrectAnswer(points) {
    currentScore += points;
    document.getElementById('current-score').textContent = currentScore;
    
    // Trigger Who Am I tile reveal
    {% if topic == 'Descriptive Statistics' %}
    onCorrectAnswer();
    {% endif %}
    
    // Your other correct answer logic...
}

// At quiz end
function finishQuiz() {
    {% if topic == 'Descriptive Statistics' %}
    const whoAmIBonus = getWhoAmIBonusPoints();
    currentScore += whoAmIBonus;
    
    if (whoAmIBonus > 0) {
        alert(`Quiz complete! You earned ${whoAmIBonus} bonus points from Who Am I!`);
    }
    {% endif %}
    
    // Submit results to backend
    submitResults(currentScore);
}
</script>

</body>
</html>


<!-- ============================================================================
     SUMMARY OF INTEGRATION STEPS
     ============================================================================
     
     1. Run the SQL file to create database tables:
        sqlite3 instance/mathquiz.db < add_who_am_i_tables.sql
     
     2. Add the routes from who_am_i_routes.py to your app.py
     
     3. Upload CSS file to: static/css/who_am_i.css
     
     4. Upload JS file to: static/js/who_am_i.js
     
     5. Upload admin template to: templates/admin_who_am_i.html
     
     6. Create folder: static/who_am_i_images/
     
     7. Modify your quiz.html to include:
        - CSS link in head
        - JS script in head
        - Who Am I container div
        - Initialize JavaScript on page load
        - Call onCorrectAnswer() when answer is correct
        - Include bonus points in final score
     
     8. Upload images via /admin/who-am-i
     
     9. Test with Descriptive Statistics topic
     
     ============================================================================ -->
